<!DOCTYPE html>
<html>
<head>
	<title></title>
  <style type="text/css">
    * {
      font-family: sans-serif;
    }

    #app-container {
      width: 100%;
    }

    #buttons-container {
      width: 225px;
      margin: auto;
    }

    #refresh-button {
      margin-right: 10px;
    }

    .button {
      width: 70px;
      height: 70px;
      padding: 15px;
      border-radius: 25px;
      border: 2px solid black;
      display: inline-block;
      cursor: pointer;

      -webkit-transition-duration: 0.4s; /* Safari */
      transition-duration: 0.4s;
    }

    .button:hover {
      background-color: lightgrey;
    }

    img {
      width: 100%;
      height: 100%;
    }

    #time-display, #word1-display, #word2-display {
      text-align: center;
      margin: 20px 0 20px 0;
    }

    #time-display {
      font-size: 120px;
    }

    #word1-display, #word2-display {
      font-size: 80px;
    }
  </style>
</head>
<body>
<div id="app-container">
  <div id="buttons-container">
    <div id="refresh-button" class="button" onclick="refresh()"><img src="images/refresh.png"></div>
    <div id="play-button" class="button" onclick="play()"><img src="images/play.png"></div>
    <div id="pause-button" class="button" onclick="pause()" style="display:none"><img src="images/pause.png"></div>
  </div>

  <div id="time-display">0:00</div>
  <div id="word1-display">hello</div>
  <div id="word2-display">snake</div>
</div>

<script type="text/javascript">
let playButton = document.getElementById("play-button");
let pauseButton = document.getElementById("pause-button");
let timeDisplay = document.getElementById("time-display");
let word1Display = document.getElementById("word1-display");
let word2Display = document.getElementById("word2-display");

let seconds = 0;
let isPaused = true;
let timer = window.setInterval(function() {
  if(!isPaused) {
    seconds++;
    updateTime()
  }
}, 1000);

refresh();

function refresh() {
  pause();
  seconds = 0;
  updateTime();

  //watchout4snakes endpoint is weird
  fetchWord(word1Display, () => { fetchWord(word2Display); });
}

function play() {
  isPaused = false;
  playButton.style.display = "none";
  pauseButton.style.display = "inline-block";
}

function pause() {
  isPaused = true;
  playButton.style.display = "inline-block";
  pauseButton.style.display = "none";
}

function updateTime() {
  timeDisplay.innerHTML = formatTime(seconds);
}

function formatTime(seconds) {
  return Math.floor(seconds/60) + ":" + (seconds % 60 < 10 ? "0" : "") + (seconds % 60);
}

function fetchWord(element, callback) {
  let xhttp = new XMLHttpRequest();
  xhttp.open("POST", "http://hellosnake.cfapps.io/snake", true);

  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      element.innerHTML = xhttp.responseText;
      if (callback) {
        callback();
      }
    }
  };

  xhttp.send();
}
</script>
</body>
</html>